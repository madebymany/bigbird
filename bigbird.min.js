(function(){"use strict";function capitaliseFirstLetter(string){return string.charAt(0).toUpperCase()+string.slice(1)}var BigBird=window.BigBird={};BigBird.VERSION="0.3.2";var $=window.jQuery||window.Zepto||window.ender||window.$;BigBird.Events=_.extend({},Eventable);var InitializerDefaults={base:document.body,modules:{}},Initializer=BigBird.Initializer=function(options){this.options=_.extend(InitializerDefaults,options),this.initialize.apply(this)};_.extend(Initializer.prototype,{initialize:function(){this.base=$(this.options.base),this.set_module_action("module"),this.set_module_action("action"),this.application=this.options.modules,$(document.body).ready(_.bind(this.setup,this))},set_module_action:function(name){var value=this.base.attr("data-"+name);if("string"!=typeof value||""===value)throw name+" was not set";this[name]=value.toLowerCase()},setup:function(){this.execute("common","initialize"),this.execute(this.module,"initialize"),this.execute(this.module,this.action)},rerunAction:function(){return this.execute(this.module,this.action)},execute:function(module,action){return module=this.getModule(module),void 0===module?!1:void 0===module[action]||"function"!=typeof module[action]?!1:(module[action].apply(),void 0)},getModule:function(moduleName){return this.application.hasOwnProperty(moduleName)?this.application[moduleName]:(moduleName=capitaliseFirstLetter(moduleName),this.application.hasOwnProperty(moduleName)?this.application[moduleName]:void 0)}});var Module=BigBird.Module=function(options){this._setOptions(options||{}),this.el&&this.setElement(this.el),this.subscriptions&&this.subscribeToEvents(),this.events&&this.delegateEvents(),this.proxied&&this.proxyFunctions(),this.initialize.apply(this,arguments)};_.extend(Module.prototype,BigBird.Events,{merge:_.extend,proxy:_.bind,publish:_.bind(BigBird.Events.trigger,BigBird.Events),subscribe:_.bind(BigBird.Events.on,BigBird.Events),$el:null,initialize:function(){},$:function(selector){return null!==this.$el?this.$el.find(selector):void 0},proxyFunctions:function(){var len=this.proxied.length;for(len;len--;){var methodName=this.proxied[len];"function"==typeof this[methodName]&&(this[methodName]=this.proxy(this[methodName],this))}},subscribeToEvents:function(){for(var key in this.subscriptions){var methodName=this.subscriptions[key];this.subscribe(key,this[methodName],this)}},delegateEvents:function(){if(null!==this.$el)for(var key in this.events){var methodName=this.events[key],method=this.proxy(this[methodName],this),match=key.match(this.eventSplitter),eventName=match[1],selector=match[2];""===selector?this.$el.on(eventName,method):this.$el.delegate(selector,eventName,method)}},eventSplitter:/^(\S+)\s*(.*)$/,activate:function(){this.$el.addClass("active")},deactivate:function(){this.$el.removeClass("active")},setElement:function(element){this.el=element||this.el,this.$el=this.el instanceof $?this.el:$(this.el),this.el=this.$el[0],this.$els=this.els={},this.data=this.$el.data()},destroy:function(){if(null!==this.$el)for(var key in this.events){var match=key.match(this.eventSplitter),eventName=match[1],selector=match[2],target=""===selector?this.$el:this.$el.find(selector);target.unbind(eventName)}},setElements:function(compiledHtml){var $html=$("<div>").html(compiledHtml);return _.each($html.find("[data-bb-el]"),_.bind(this._setBBElement,this)),$html.unwrap()},_setBBElement:function(element){var $element=$(element),name=$element.attr("data-bb-el");this.els[name]=element,this.$els[name]=$element},_setOptions:function(options){this.options=options;for(var key in this.options)this[key]=this.options[key]}});var extend=function(protoProps,staticProps){var child,parent=this;child=protoProps&&protoProps.hasOwnProperty("constructor")?protoProps.constructor:function(){parent.apply(this,arguments)},_.extend(child,parent,staticProps);var Surrogate=function(){this.constructor=child};return Surrogate.prototype=parent.prototype,child.prototype=new Surrogate,protoProps&&_.extend(child.prototype,protoProps),child.__super__=parent.prototype,child};Module.extend=extend,"undefined"!=typeof define&&"function"==typeof define&&define.amd&&define("bigbird",[],function(){return BigBird})})();