// Big Bird
// v0.1.0
// by @cjbell88, @ninjabiscuit & @callumj_
(function(){function f(e){return e.charAt(0).toUpperCase()+e.slice(1)}var e=window.BigBird={},t=jQuery;!t&&typeof require!="undefined"&&(t=require("jquery"));var n=t({});t.subscribe=function(){n.on.apply(n,arguments)},t.unsubscribe=function(){n.off.apply(n,arguments)},t.publish=function(){n.trigger.apply(n,arguments)};var r={base:t(document.body),module:"data-module",action:"data-action",modules:{}},i=e.Initializer=function(e){this.options=t.extend({},r,e||{}),this.initialize.apply(this,arguments)};t.extend(i.prototype,{initialize:function(){this.base=this.options.base,this.module=this.base.attr(this.options.module),this.action=this.base.attr(this.options.action),this.application=this.options.modules;if(this.module===undefined||this.action===undefined||this.application===undefined)return!1;this.module&&(this.module=this.module.toLowerCase()),this.action&&(this.action=this.action.toLowerCase()),t(document.body).ready(t.proxy(this.setup,this))},setup:function(){this.execute("common","initialize"),this.execute(this.module,"initialize"),this.execute(this.module,this.action)},rerunAction:function(){return this.execute(this.module,this.action)},execute:function(e,t){e=this.getModule(e);if(e===undefined)return!1;if(e[t]===undefined||typeof e[t]!="function")return!1;e[t].apply()},getModule:function(e){return this.application.hasOwnProperty(e)?this.application[e]:(e=f(e),this.application.hasOwnProperty(e)?this.application[e]:undefined)}});var s={publish:t.publish,subscribe:t.subscribe,initialize:function(){},subscribeToEvents:function(){for(var e in this.subscriptions){var n=this.subscriptions[e];this.subscribe(e,t.proxy(this[n],this))}},eventSplitter:/^(\S+)\s*(.*)$/,_setOptions:function(e){this.options=e;for(var t in this.options)this[t]=this.options[t]}},o=e.Controller=function(e){this._setOptions(e||{}),this.subscriptions&&this.subscribeToEvents(),this.proxied&&this.proxyFunctions(),this.initialize.apply(this,arguments)};t.extend(o.prototype,s,{proxyFunctions:function(){var e=this.proxied.length;for(e;e--;){var n=this.proxied[e];typeof this[n]=="function"&&(this[n]=t.proxy(this[n],this))}}}),e.StateMachine=function(){this.o=t({})},e.StateMachine.prototype={publish:function(){this.o.trigger.apply(this.o,arguments)},subscribe:function(){this.o.bind.apply(this.o,arguments)},add:function(e){this.subscribe("change",function(t,n){return n===e?e.activate():e.deactivate()}),e.prototype.active=t.proxy(function(){this.publish("change",e)},this)}},t.fn.activate=function(){return this.each(function(){t(this).addClass("active")})},t.fn.deactivate=function(){return this.each(function(){t(this).removeClass("active")})},t.fn.withState=function(e){return this.each(function(){e.add(t(this))})};var u=e.View=function(e){this._setElement(),this._setOptions(e||{}),this.stateful&&this.makeStateful(),this.subscriptions&&this.subscribeToEvents(),this.events&&this.delegateEvents(),this.initialize.apply(this,arguments)};t.extend(u.prototype,s,{$:function(e){return this.$el.find(e)},makeStateful:function(){var t=new e.StateMachine;this.stateful.withState(t)},delegateEvents:function(){for(var e in this.events){var n=this.events[e],r=t.proxy(this[n],this),i=e.match(this.eventSplitter),s=i[1],o=i[2];o===""?this.$el.bind(s,r):this.$el.delegate(o,s,r)}},_setElement:function(){if(this.el===undefined)return!1;this.$el=this.el instanceof t?this.el:t(this.el),this.el=this.$el[0],this.data=this.$el.data()}});var a=function(e,n){var r=this,i;e&&e.hasOwnProperty("constructor")?i=e.constructor:i=function(){r.apply(this,arguments)},t.extend(i,r,n);var s=function(){this.constructor=i};return s.prototype=r.prototype,i.prototype=new s,e&&t.extend(i.prototype,e),i.__super__=r.prototype,i};u.extend=o.extend=a,typeof define!="undefined"&&typeof define=="function"&&define.amd&&define("bigbird",[],function(){return e})})();